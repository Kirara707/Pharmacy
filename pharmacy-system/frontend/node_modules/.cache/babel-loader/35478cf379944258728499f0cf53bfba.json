{"remainingRequest":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\src\\views\\Sales.vue?vue&type=template&id=4e7ca942&scoped=true","dependencies":[{"path":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\src\\views\\Sales.vue","mtime":1750135723163},{"path":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\babel.config.js","mtime":1750139368336},{"path":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1750139103810},{"path":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1750139103814},{"path":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1750139102462},{"path":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1750139103810},{"path":"C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1750139102365}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY3JlYXRlRWxlbWVudFZOb2RlIGFzIF9jcmVhdGVFbGVtZW50Vk5vZGUsIGNyZWF0ZVRleHRWTm9kZSBhcyBfY3JlYXRlVGV4dFZOb2RlLCByZXNvbHZlQ29tcG9uZW50IGFzIF9yZXNvbHZlQ29tcG9uZW50LCB3aXRoQ3R4IGFzIF93aXRoQ3R4LCBvcGVuQmxvY2sgYXMgX29wZW5CbG9jaywgY3JlYXRlQmxvY2sgYXMgX2NyZWF0ZUJsb2NrLCBjcmVhdGVDb21tZW50Vk5vZGUgYXMgX2NyZWF0ZUNvbW1lbnRWTm9kZSwgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCB0b0Rpc3BsYXlTdHJpbmcgYXMgX3RvRGlzcGxheVN0cmluZywgcmVzb2x2ZURpcmVjdGl2ZSBhcyBfcmVzb2x2ZURpcmVjdGl2ZSwgd2l0aERpcmVjdGl2ZXMgYXMgX3dpdGhEaXJlY3RpdmVzLCByZW5kZXJMaXN0IGFzIF9yZW5kZXJMaXN0LCBGcmFnbWVudCBhcyBfRnJhZ21lbnQsIGNyZWF0ZUVsZW1lbnRCbG9jayBhcyBfY3JlYXRlRWxlbWVudEJsb2NrIH0gZnJvbSAidnVlIjsKY29uc3QgX2hvaXN0ZWRfMSA9IHsKICBjbGFzczogInNhbGVzLWNvbnRhaW5lciIKfTsKY29uc3QgX2hvaXN0ZWRfMiA9IHsKICBjbGFzczogImhlYWRlciIKfTsKY29uc3QgX2hvaXN0ZWRfMyA9IHsKICBzdHlsZTogewogICAgImZsb2F0IjogInJpZ2h0IiwKICAgICJjb2xvciI6ICIjODQ5MmE2IiwKICAgICJmb250LXNpemUiOiAiMTNweCIKICB9Cn07CmNvbnN0IF9ob2lzdGVkXzQgPSB7CiAgY2xhc3M6ICJkaWFsb2ctZm9vdGVyIgp9OwpleHBvcnQgZnVuY3Rpb24gcmVuZGVyKF9jdHgsIF9jYWNoZSwgJHByb3BzLCAkc2V0dXAsICRkYXRhLCAkb3B0aW9ucykgewogIGNvbnN0IF9jb21wb25lbnRfZWxfYnV0dG9uID0gX3Jlc29sdmVDb21wb25lbnQoImVsLWJ1dHRvbiIpOwogIGNvbnN0IF9jb21wb25lbnRfZWxfdGFibGVfY29sdW1uID0gX3Jlc29sdmVDb21wb25lbnQoImVsLXRhYmxlLWNvbHVtbiIpOwogIGNvbnN0IF9jb21wb25lbnRfZWxfdGFibGUgPSBfcmVzb2x2ZUNvbXBvbmVudCgiZWwtdGFibGUiKTsKICBjb25zdCBfY29tcG9uZW50X2VsX29wdGlvbiA9IF9yZXNvbHZlQ29tcG9uZW50KCJlbC1vcHRpb24iKTsKICBjb25zdCBfY29tcG9uZW50X2VsX3NlbGVjdCA9IF9yZXNvbHZlQ29tcG9uZW50KCJlbC1zZWxlY3QiKTsKICBjb25zdCBfY29tcG9uZW50X2VsX2Zvcm1faXRlbSA9IF9yZXNvbHZlQ29tcG9uZW50KCJlbC1mb3JtLWl0ZW0iKTsKICBjb25zdCBfY29tcG9uZW50X2VsX2lucHV0X251bWJlciA9IF9yZXNvbHZlQ29tcG9uZW50KCJlbC1pbnB1dC1udW1iZXIiKTsKICBjb25zdCBfY29tcG9uZW50X2VsX2Zvcm0gPSBfcmVzb2x2ZUNvbXBvbmVudCgiZWwtZm9ybSIpOwogIGNvbnN0IF9jb21wb25lbnRfZWxfZGlhbG9nID0gX3Jlc29sdmVDb21wb25lbnQoImVsLWRpYWxvZyIpOwogIGNvbnN0IF9kaXJlY3RpdmVfbG9hZGluZyA9IF9yZXNvbHZlRGlyZWN0aXZlKCJsb2FkaW5nIik7CiAgcmV0dXJuIF9vcGVuQmxvY2soKSwgX2NyZWF0ZUVsZW1lbnRCbG9jaygiZGl2IiwgX2hvaXN0ZWRfMSwgW19jcmVhdGVFbGVtZW50Vk5vZGUoImRpdiIsIF9ob2lzdGVkXzIsIFtfY2FjaGVbNV0gfHwgKF9jYWNoZVs1XSA9IF9jcmVhdGVFbGVtZW50Vk5vZGUoImgyIiwgbnVsbCwgIumUgOWUruiusOW9lSIsIC0xIC8qIEhPSVNURUQgKi8pKSwgJHNldHVwLmNhbkFkZFNhbGUgPyAoX29wZW5CbG9jaygpLCBfY3JlYXRlQmxvY2soX2NvbXBvbmVudF9lbF9idXR0b24sIHsKICAgIGtleTogMCwKICAgIHR5cGU6ICJwcmltYXJ5IiwKICAgIG9uQ2xpY2s6ICRzZXR1cC5zaG93QWRkRGlhbG9nCiAgfSwgewogICAgZGVmYXVsdDogX3dpdGhDdHgoKCkgPT4gX2NhY2hlWzRdIHx8IChfY2FjaGVbNF0gPSBbX2NyZWF0ZVRleHRWTm9kZSgiIOaWsOWinumUgOWUruiusOW9lSAiKV0pKSwKICAgIF86IDEgLyogU1RBQkxFICovLAogICAgX186IFs0XQogIH0sIDggLyogUFJPUFMgKi8sIFsib25DbGljayJdKSkgOiBfY3JlYXRlQ29tbWVudFZOb2RlKCJ2LWlmIiwgdHJ1ZSldKSwgX3dpdGhEaXJlY3RpdmVzKChfb3BlbkJsb2NrKCksIF9jcmVhdGVCbG9jayhfY29tcG9uZW50X2VsX3RhYmxlLCB7CiAgICBkYXRhOiAkc2V0dXAuc2FsZXMsCiAgICBzdHlsZTogewogICAgICAid2lkdGgiOiAiMTAwJSIKICAgIH0KICB9LCB7CiAgICBkZWZhdWx0OiBfd2l0aEN0eCgoKSA9PiBbX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfdGFibGVfY29sdW1uLCB7CiAgICAgIHByb3A6ICJpZCIsCiAgICAgIGxhYmVsOiAi6K6w5b2VSUQiLAogICAgICB3aWR0aDogIjEwMCIKICAgIH0pLCBfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF9lbF90YWJsZV9jb2x1bW4sIHsKICAgICAgcHJvcDogIm1lZGljaW5lLm5hbWUiLAogICAgICBsYWJlbDogIuiNr+WTgeWQjeensCIKICAgIH0pLCBfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF9lbF90YWJsZV9jb2x1bW4sIHsKICAgICAgcHJvcDogInF1YW50aXR5IiwKICAgICAgbGFiZWw6ICLmlbDph48iCiAgICB9KSwgX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfdGFibGVfY29sdW1uLCB7CiAgICAgIHByb3A6ICJ0b3RhbF9wcmljZSIsCiAgICAgIGxhYmVsOiAi5oC75Lu3IgogICAgfSwgewogICAgICBkZWZhdWx0OiBfd2l0aEN0eChzY29wZSA9PiBbX2NyZWF0ZVRleHRWTm9kZSgiIMKlIiArIF90b0Rpc3BsYXlTdHJpbmcoc2NvcGUucm93LnRvdGFsX3ByaWNlLnRvRml4ZWQoMikpLCAxIC8qIFRFWFQgKi8pXSksCiAgICAgIF86IDEgLyogU1RBQkxFICovCiAgICB9KSwgX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfdGFibGVfY29sdW1uLCB7CiAgICAgIHByb3A6ICJjcmVhdGVkX2F0IiwKICAgICAgbGFiZWw6ICLplIDllK7ml7bpl7QiCiAgICB9LCB7CiAgICAgIGRlZmF1bHQ6IF93aXRoQ3R4KHNjb3BlID0+IFtfY3JlYXRlVGV4dFZOb2RlKF90b0Rpc3BsYXlTdHJpbmcobmV3IERhdGUoc2NvcGUucm93LmNyZWF0ZWRfYXQpLnRvTG9jYWxlU3RyaW5nKCkpLCAxIC8qIFRFWFQgKi8pXSksCiAgICAgIF86IDEgLyogU1RBQkxFICovCiAgICB9KSwgJHNldHVwLmNhbkVkaXRTYWxlID8gKF9vcGVuQmxvY2soKSwgX2NyZWF0ZUJsb2NrKF9jb21wb25lbnRfZWxfdGFibGVfY29sdW1uLCB7CiAgICAgIGtleTogMCwKICAgICAgbGFiZWw6ICLmk43kvZwiCiAgICB9LCB7CiAgICAgIGRlZmF1bHQ6IF93aXRoQ3R4KHNjb3BlID0+IFtfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF9lbF9idXR0b24sIHsKICAgICAgICBzaXplOiAic21hbGwiLAogICAgICAgIHR5cGU6ICJkYW5nZXIiLAogICAgICAgIG9uQ2xpY2s6ICRldmVudCA9PiAkc2V0dXAuaGFuZGxlRGVsZXRlKHNjb3BlLnJvdykKICAgICAgfSwgewogICAgICAgIGRlZmF1bHQ6IF93aXRoQ3R4KCgpID0+IF9jYWNoZVs2XSB8fCAoX2NhY2hlWzZdID0gW19jcmVhdGVUZXh0Vk5vZGUoIiDliKDpmaQgIildKSksCiAgICAgICAgXzogMiAvKiBEWU5BTUlDICovLAogICAgICAgIF9fOiBbNl0KICAgICAgfSwgMTAzMiAvKiBQUk9QUywgRFlOQU1JQ19TTE9UUyAqLywgWyJvbkNsaWNrIl0pXSksCiAgICAgIF86IDEgLyogU1RBQkxFICovCiAgICB9KSkgOiBfY3JlYXRlQ29tbWVudFZOb2RlKCJ2LWlmIiwgdHJ1ZSldKSwKICAgIF86IDEgLyogU1RBQkxFICovCiAgfSwgOCAvKiBQUk9QUyAqLywgWyJkYXRhIl0pKSwgW1tfZGlyZWN0aXZlX2xvYWRpbmcsICRzZXR1cC5sb2FkaW5nXV0pLCBfY3JlYXRlQ29tbWVudFZOb2RlKCIg5re75Yqg6ZSA5ZSu6K6w5b2V5a+56K+d5qGGICIpLCBfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF9lbF9kaWFsb2csIHsKICAgIHRpdGxlOiAi5paw5aKe6ZSA5ZSu6K6w5b2VIiwKICAgIG1vZGVsVmFsdWU6ICRzZXR1cC5kaWFsb2dWaXNpYmxlLAogICAgIm9uVXBkYXRlOm1vZGVsVmFsdWUiOiBfY2FjaGVbM10gfHwgKF9jYWNoZVszXSA9ICRldmVudCA9PiAkc2V0dXAuZGlhbG9nVmlzaWJsZSA9ICRldmVudCksCiAgICB3aWR0aDogIjUwMHB4IgogIH0sIHsKICAgIGZvb3RlcjogX3dpdGhDdHgoKCkgPT4gW19jcmVhdGVFbGVtZW50Vk5vZGUoInNwYW4iLCBfaG9pc3RlZF80LCBbX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfYnV0dG9uLCB7CiAgICAgIG9uQ2xpY2s6IF9jYWNoZVsyXSB8fCAoX2NhY2hlWzJdID0gJGV2ZW50ID0+ICRzZXR1cC5kaWFsb2dWaXNpYmxlID0gZmFsc2UpCiAgICB9LCB7CiAgICAgIGRlZmF1bHQ6IF93aXRoQ3R4KCgpID0+IF9jYWNoZVs3XSB8fCAoX2NhY2hlWzddID0gW19jcmVhdGVUZXh0Vk5vZGUoIuWPlua2iCIpXSkpLAogICAgICBfOiAxIC8qIFNUQUJMRSAqLywKICAgICAgX186IFs3XQogICAgfSksIF9jcmVhdGVWTm9kZShfY29tcG9uZW50X2VsX2J1dHRvbiwgewogICAgICB0eXBlOiAicHJpbWFyeSIsCiAgICAgIG9uQ2xpY2s6ICRzZXR1cC5oYW5kbGVTdWJtaXQKICAgIH0sIHsKICAgICAgZGVmYXVsdDogX3dpdGhDdHgoKCkgPT4gX2NhY2hlWzhdIHx8IChfY2FjaGVbOF0gPSBbX2NyZWF0ZVRleHRWTm9kZSgiIOehruWumiAiKV0pKSwKICAgICAgXzogMSAvKiBTVEFCTEUgKi8sCiAgICAgIF9fOiBbOF0KICAgIH0sIDggLyogUFJPUFMgKi8sIFsib25DbGljayJdKV0pXSksCiAgICBkZWZhdWx0OiBfd2l0aEN0eCgoKSA9PiBbX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfZm9ybSwgewogICAgICBtb2RlbDogJHNldHVwLnNhbGVGb3JtLAogICAgICBydWxlczogJHNldHVwLnJ1bGVzLAogICAgICByZWY6ICJzYWxlRm9ybSIsCiAgICAgICJsYWJlbC13aWR0aCI6ICIxMDBweCIKICAgIH0sIHsKICAgICAgZGVmYXVsdDogX3dpdGhDdHgoKCkgPT4gW19jcmVhdGVWTm9kZShfY29tcG9uZW50X2VsX2Zvcm1faXRlbSwgewogICAgICAgIGxhYmVsOiAi6I2v5ZOBIiwKICAgICAgICBwcm9wOiAibWVkaWNpbmVfaWQiCiAgICAgIH0sIHsKICAgICAgICBkZWZhdWx0OiBfd2l0aEN0eCgoKSA9PiBbX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfc2VsZWN0LCB7CiAgICAgICAgICBtb2RlbFZhbHVlOiAkc2V0dXAuc2FsZUZvcm0ubWVkaWNpbmVfaWQsCiAgICAgICAgICAib25VcGRhdGU6bW9kZWxWYWx1ZSI6IF9jYWNoZVswXSB8fCAoX2NhY2hlWzBdID0gJGV2ZW50ID0+ICRzZXR1cC5zYWxlRm9ybS5tZWRpY2luZV9pZCA9ICRldmVudCksCiAgICAgICAgICBwbGFjZWhvbGRlcjogIuivt+mAieaLqeiNr+WTgSIsCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAid2lkdGgiOiAiMTAwJSIKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBkZWZhdWx0OiBfd2l0aEN0eCgoKSA9PiBbKF9vcGVuQmxvY2sodHJ1ZSksIF9jcmVhdGVFbGVtZW50QmxvY2soX0ZyYWdtZW50LCBudWxsLCBfcmVuZGVyTGlzdCgkc2V0dXAubWVkaWNpbmVzLCBtZWRpY2luZSA9PiB7CiAgICAgICAgICAgIHJldHVybiBfb3BlbkJsb2NrKCksIF9jcmVhdGVCbG9jayhfY29tcG9uZW50X2VsX29wdGlvbiwgewogICAgICAgICAgICAgIGtleTogbWVkaWNpbmUuaWQsCiAgICAgICAgICAgICAgbGFiZWw6IG1lZGljaW5lLm5hbWUsCiAgICAgICAgICAgICAgdmFsdWU6IG1lZGljaW5lLmlkCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBkZWZhdWx0OiBfd2l0aEN0eCgoKSA9PiBbX2NyZWF0ZUVsZW1lbnRWTm9kZSgic3BhbiIsIG51bGwsIF90b0Rpc3BsYXlTdHJpbmcobWVkaWNpbmUubmFtZSksIDEgLyogVEVYVCAqLyksIF9jcmVhdGVFbGVtZW50Vk5vZGUoInNwYW4iLCBfaG9pc3RlZF8zLCAiIOW6k+WtmDogIiArIF90b0Rpc3BsYXlTdHJpbmcobWVkaWNpbmUuc3RvY2spLCAxIC8qIFRFWFQgKi8pXSksCiAgICAgICAgICAgICAgXzogMiAvKiBEWU5BTUlDICovCiAgICAgICAgICAgIH0sIDEwMzIgLyogUFJPUFMsIERZTkFNSUNfU0xPVFMgKi8sIFsibGFiZWwiLCAidmFsdWUiXSk7CiAgICAgICAgICB9KSwgMTI4IC8qIEtFWUVEX0ZSQUdNRU5UICovKSldKSwKICAgICAgICAgIF86IDEgLyogU1RBQkxFICovCiAgICAgICAgfSwgOCAvKiBQUk9QUyAqLywgWyJtb2RlbFZhbHVlIl0pXSksCiAgICAgICAgXzogMSAvKiBTVEFCTEUgKi8KICAgICAgfSksIF9jcmVhdGVWTm9kZShfY29tcG9uZW50X2VsX2Zvcm1faXRlbSwgewogICAgICAgIGxhYmVsOiAi5pWw6YePIiwKICAgICAgICBwcm9wOiAicXVhbnRpdHkiCiAgICAgIH0sIHsKICAgICAgICBkZWZhdWx0OiBfd2l0aEN0eCgoKSA9PiBbX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfaW5wdXRfbnVtYmVyLCB7CiAgICAgICAgICBtb2RlbFZhbHVlOiAkc2V0dXAuc2FsZUZvcm0ucXVhbnRpdHksCiAgICAgICAgICAib25VcGRhdGU6bW9kZWxWYWx1ZSI6IF9jYWNoZVsxXSB8fCAoX2NhY2hlWzFdID0gJGV2ZW50ID0+ICRzZXR1cC5zYWxlRm9ybS5xdWFudGl0eSA9ICRldmVudCksCiAgICAgICAgICBtaW46IDEsCiAgICAgICAgICBtYXg6ICRzZXR1cC5nZXRNYXhRdWFudGl0eSwKICAgICAgICAgIHByZWNpc2lvbjogMAogICAgICAgIH0sIG51bGwsIDggLyogUFJPUFMgKi8sIFsibW9kZWxWYWx1ZSIsICJtYXgiXSldKSwKICAgICAgICBfOiAxIC8qIFNUQUJMRSAqLwogICAgICB9KV0pLAogICAgICBfOiAxIC8qIFNUQUJMRSAqLwogICAgfSwgOCAvKiBQUk9QUyAqLywgWyJtb2RlbCIsICJydWxlcyJdKV0pLAogICAgXzogMSAvKiBTVEFCTEUgKi8KICB9LCA4IC8qIFBST1BTICovLCBbIm1vZGVsVmFsdWUiXSldKTsKfQ=="},{"version":3,"names":["class","style","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","$setup","canAddSale","_createBlock","_component_el_button","type","onClick","showAddDialog","_cache","_component_el_table","data","sales","_createVNode","_component_el_table_column","prop","label","width","default","_withCtx","scope","_toDisplayString","row","total_price","toFixed","Date","created_at","toLocaleString","canEditSale","size","$event","handleDelete","loading","_createCommentVNode","_component_el_dialog","title","dialogVisible","footer","_hoisted_4","handleSubmit","_component_el_form","model","saleForm","rules","ref","_component_el_form_item","_component_el_select","medicine_id","placeholder","_Fragment","_renderList","medicines","medicine","_component_el_option","key","id","name","value","_hoisted_3","stock","_component_el_input_number","quantity","min","max","getMaxQuantity","precision"],"sources":["C:\\Users\\lizhe\\Desktop\\database\\pharmacy-system\\frontend\\src\\views\\Sales.vue"],"sourcesContent":["<template>\r\n  <div class=\"sales-container\">\r\n    <div class=\"header\">\r\n      <h2>销售记录</h2>\r\n      <el-button type=\"primary\" @click=\"showAddDialog\" v-if=\"canAddSale\">\r\n        新增销售记录\r\n      </el-button>\r\n    </div>\r\n\r\n    <el-table\r\n      v-loading=\"loading\"\r\n      :data=\"sales\"\r\n      style=\"width: 100%\">\r\n      <el-table-column prop=\"id\" label=\"记录ID\" width=\"100\" />\r\n      <el-table-column prop=\"medicine.name\" label=\"药品名称\" />\r\n      <el-table-column prop=\"quantity\" label=\"数量\" />\r\n      <el-table-column prop=\"total_price\" label=\"总价\">\r\n        <template #default=\"scope\">\r\n          ¥{{ scope.row.total_price.toFixed(2) }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"created_at\" label=\"销售时间\">\r\n        <template #default=\"scope\">\r\n          {{ new Date(scope.row.created_at).toLocaleString() }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" v-if=\"canEditSale\">\r\n        <template #default=\"scope\">\r\n          <el-button\r\n            size=\"small\"\r\n            type=\"danger\"\r\n            @click=\"handleDelete(scope.row)\">\r\n            删除\r\n          </el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 添加销售记录对话框 -->\r\n    <el-dialog\r\n      title=\"新增销售记录\"\r\n      v-model=\"dialogVisible\"\r\n      width=\"500px\">\r\n      <el-form\r\n        :model=\"saleForm\"\r\n        :rules=\"rules\"\r\n        ref=\"saleForm\"\r\n        label-width=\"100px\">\r\n        <el-form-item label=\"药品\" prop=\"medicine_id\">\r\n          <el-select\r\n            v-model=\"saleForm.medicine_id\"\r\n            placeholder=\"请选择药品\"\r\n            style=\"width: 100%\">\r\n            <el-option\r\n              v-for=\"medicine in medicines\"\r\n              :key=\"medicine.id\"\r\n              :label=\"medicine.name\"\r\n              :value=\"medicine.id\">\r\n              <span>{{ medicine.name }}</span>\r\n              <span style=\"float: right; color: #8492a6; font-size: 13px\">\r\n                库存: {{ medicine.stock }}\r\n              </span>\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"数量\" prop=\"quantity\">\r\n          <el-input-number\r\n            v-model=\"saleForm.quantity\"\r\n            :min=\"1\"\r\n            :max=\"getMaxQuantity\"\r\n            :precision=\"0\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handleSubmit\">\r\n            确定\r\n          </el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport axios from 'axios'\r\n\r\nexport default {\r\n  name: 'Sales',\r\n  setup() {\r\n    const store = useStore()\r\n    const loading = ref(false)\r\n    const dialogVisible = ref(false)\r\n    const saleForm = ref({\r\n      medicine_id: '',\r\n      quantity: 1\r\n    })\r\n\r\n    const rules = {\r\n      medicine_id: [\r\n        { required: true, message: '请选择药品', trigger: 'change' }\r\n      ],\r\n      quantity: [\r\n        { required: true, message: '请输入数量', trigger: 'blur' }\r\n      ]\r\n    }\r\n\r\n    const sales = computed(() => store.state.sales.list)\r\n    const medicines = computed(() => store.state.medicines.list)\r\n    const userRole = computed(() => store.state.auth.user?.role)\r\n\r\n    const canAddSale = computed(() => {\r\n      return ['admin', 'salesperson'].includes(userRole.value)\r\n    })\r\n\r\n    const canEditSale = computed(() => {\r\n      return ['admin', 'salesperson'].includes(userRole.value)\r\n    })\r\n\r\n    const getMaxQuantity = computed(() => {\r\n      const selectedMedicine = medicines.value.find(m => m.id === saleForm.value.medicine_id)\r\n      return selectedMedicine ? selectedMedicine.stock : 0\r\n    })\r\n\r\n    const fetchSales = async () => {\r\n      try {\r\n        loading.value = true\r\n        await store.dispatch('sales/fetchSales')\r\n      } catch (error) {\r\n        ElMessage.error(error.message)\r\n      } finally {\r\n        loading.value = false\r\n      }\r\n    }\r\n\r\n    const fetchMedicines = async () => {\r\n      try {\r\n        await store.dispatch('medicines/fetchMedicines')\r\n      } catch (error) {\r\n        ElMessage.error(error.message)\r\n      }\r\n    }\r\n\r\n    const showAddDialog = () => {\r\n      saleForm.value = {\r\n        medicine_id: '',\r\n        quantity: 1\r\n      }\r\n      dialogVisible.value = true\r\n    }\r\n\r\n    const handleDelete = async (row) => {\r\n      try {\r\n        await ElMessageBox.confirm('确定要删除这条销售记录吗？', '警告', {\r\n          type: 'warning'\r\n        })\r\n        await axios.delete(`http://localhost:5000/api/sales/${row.id}`)\r\n        ElMessage.success('删除成功')\r\n        fetchSales()\r\n      } catch (error) {\r\n        if (error !== 'cancel') {\r\n          ElMessage.error(error.response?.data?.message || '删除失败')\r\n        }\r\n      }\r\n    }\r\n\r\n    const handleSubmit = async () => {\r\n      try {\r\n        await axios.post('http://localhost:5000/api/sales', saleForm.value)\r\n        ElMessage.success('添加成功')\r\n        dialogVisible.value = false\r\n        fetchSales()\r\n        fetchMedicines() // 刷新药品库存\r\n      } catch (error) {\r\n        ElMessage.error(error.response?.data?.message || '操作失败')\r\n      }\r\n    }\r\n\r\n    onMounted(() => {\r\n      fetchSales()\r\n      fetchMedicines()\r\n    })\r\n\r\n    return {\r\n      loading,\r\n      sales,\r\n      medicines,\r\n      dialogVisible,\r\n      saleForm,\r\n      rules,\r\n      canAddSale,\r\n      canEditSale,\r\n      getMaxQuantity,\r\n      showAddDialog,\r\n      handleDelete,\r\n      handleSubmit\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.sales-container {\r\n  padding: 20px;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.dialog-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 10px;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]}]}